<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BeatBazar - Party Room</title>
    <link rel="icon" type="image/png" href="/assets/beatbazar-favicon.png" />
    <link rel="stylesheet" href="/styles.css">


    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
      rel="stylesheet"
    />

    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.2/src/fill/style.css"
    />

    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.2/src/bold/style.css"
    />
</head>
<body>

    <div class="header">
        <div class="left-inner">
            <svg xmlns="http://www.w3.org/2000/svg" width="52" height="52" viewBox="0 0 60 60" fill="none">
                <path d="M30 0C13.4818 0 0 13.4818 0 30C0 46.5182 13.4818 60 30 60C46.5182 60 60 46.5182 60 30C60 13.4818 46.5182 0 30 0ZM8.38057 30C8.38057 23.8057 11.0526 18.0972 15.3036 14.2105C17.004 12.6316 19.919 13.1174 21.1336 15.1822L28.664 28.1782C29.3927 29.3927 29.3927 30.8502 28.664 32.0648L21.1336 45.0607C19.919 47.247 17.004 47.6113 15.1822 45.9109C11.0526 41.7814 8.38057 36.1943 8.38057 30ZM38.8664 44.8178L31.336 31.8219C30.6073 30.6073 30.6073 29.1498 31.336 27.9352L38.8664 14.9393C40.081 12.8745 42.8745 12.3887 44.6964 13.9676C48.9474 17.8543 51.6194 23.5628 51.6194 29.7571C51.6194 35.9514 48.9474 41.6599 44.6964 45.5466C42.8745 47.4899 40.081 47.004 38.8664 44.8178Z" fill="#2E6CF5"/>
              </svg>
                <div class="text-wrapper">
                    <h2 id="room-name">Room Name</h2>
                    <p id="active-user-count" class="secondary">16 lyttere</p>
                </div>
        </div>

        <div class="right-inner">
            <div id="user-list"></div>
            <div class="join-wrapper">
                <div class="brand-btn" id="invite-btn">
                    <i class="ph-fill ph-user-plus"></i>
                    <p>Inviter lytter</p>
                </div>
                <div id="join-dropdown" class="dropdown">
                    <div class="dropdown-header">
                        <p class="primary">Inviter lyttere</p>
                        <p class="secondary">Deltag via en af 2 metoder</p>
                    </div>

                    <div class="dropdown-content">
                        <p>1. Scan QR Kode</p>
                        <div class="qr-wrapper" id="qr"></div>
                    </div>

                    <div class="dropdown-content">
                        <p>2. Brug Kode</p>
                        <div class="code-wrapper">
                            <i class="ph-bold ph-copy"></i>
                            <p id="join-code">1234</p>
                        </div>
                    </div>
                    <script>
                        document.querySelector('.code-wrapper').addEventListener('click', () => {
                            const code = document.getElementById('join-code').textContent;
    
                           navigator.clipboard.writeText(code).then(() => {
                                  const codeElement = document.getElementById('join-code');
                                  const originalText = codeElement.textContent;
                               codeElement.textContent = 'Kopieret!';
        
                              setTimeout(() => {
                                  codeElement.textContent = originalText;
                              }, 1500);
                            }).catch(err => {
                                console.error('Failed to copy:', err);
                            });
                        });
                    </script>
                </div>
            </div>
        </div>
    </div>


    <div class="content">
        <div class="container left">
            <div class="container">
                <div class="cover-wrapper">
                    
                    <img id="song-cover" class="cover" src="https://i1.sndcdn.com/artworks-000338973915-kzzyns-t500x500.jpg">
                    <div class="song-wrapper">
                        <div class="inline-container">
                            <div>
                                <h3 id="song-title">Paint it, Black</h3>
                                <p id="song-artist">The Rolling Stones</p>
                            </div>

                            <div>
            <a style="all: unset; cursor: pointer;">
                <i class="ph-bold ph-thumbs-down" onclick="toggleFill(this)"></i>
            </a>

            <a style="all: unset; cursor: pointer;">
                <i class="ph-bold ph-thumbs-up" onclick="toggleFill(this)"></i>
            </a>

            <script>
                function toggleFill(icon) {
    // like/dislike filled
    icon.style.setProperty("color", "white", "important");
    
    if (icon.classList.contains("ph-bold")) {
        icon.classList.remove("ph-bold");
        icon.classList.add("ph-fill");
    }
    
    // like/dislike skifter tilbage efter 2 sekunder
    setTimeout(() => {
        icon.style.removeProperty("color");
        
        if (icon.classList.contains("ph-fill")) {
            icon.classList.remove("ph-fill");
            icon.classList.add("ph-bold");
        }
    }, 2000); // 2000ms = 2 seconds
}
            </script>


        
                            </div>
                        </div>
                        <div class="media-player">
                            <p id="song-start">0:00</p>
                        <div class="progress-container">
                            <div id="progress-bar"></div>
                            <div id="progress-knob"></div>
                        </div>
                            <p id="song-end">3:00</p>
                        </div>
                    </div>
                </div>
                <div class="skip-container">
                <button class="skip-button" id="skipButton">
                    <span class="skip-text">Skip</span>
                    <span class="skip-arrow">›</span>
                </button>
                <div class="skip-votes-container">
                    <span id="skip-count">0/0</span>
                    <span class="votes-label">votes</span>
                    </div>
                    
                </div>

                
            </div>
        </div>

        <div class="container right">
            <div class="queue">
                <h3>Kø</h3>
                <div id="queue-list"></div>
        </div>
    </div>
    <br>    
    </div>
    <div class="footer">
        <div class="btn-wrapper">
            <div id="more-options" class="secondary-btn">
                <p>Tryk for at ønske sange</p>
                <i class="ph-fill ph-dots-three-outline"></i>
            </div>
        </div>
    </div>
   

    <script src="/index.js"></script>
    <script src="/qr.min.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const roomId = window.location.pathname.split('/')[2];

            startRoomPolling(roomId, 3000);
        });
    </script>

    <script>
        const trigger = document.getElementById('invite-btn');
        const dropdown = document.getElementById('join-dropdown');

        // Toggle dropdown on trigger click
        trigger.addEventListener('click', (e) => {
        e.stopPropagation(); // Prevent click from bubbling to document
        dropdown.classList.toggle('open');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
        if (!dropdown.contains(e.target) && !trigger.contains(e.target)) {
            dropdown.classList.remove('open');
        }
        });
    </script>
    <div id="search-modal" class="search-modal hidden">
    <div class="search-modal-content">
        <div class="search-header">
            <input type="text" placeholder="Find what you like" class="search-input">
        </div>

        <div class="filter-row">
            <button class="filter-btn active" data-type="all">All</button>
            <button class="filter-btn" data-type="genres">Genres</button>
            <button class="filter-btn" data-type="mood">Mood</button>
            <button class="filter-btn" data-type="tempo">Tempo</button>
        </div>


        <div class="search-list">
            <div class="search-item">
                <i class="ph-bold ph-rocket"></i>
                <div>
                    <p>High energy</p>
                    <span>Tempo</span>
                </div>
            </div>

            <div class="search-item">
                <i class="ph-bold ph-smiley"></i>
                <div>
                    <p>Uplifting</p>
                    <span>Mood</span>
                </div>
            </div>

            <div class="search-item">
                <i class="ph-bold ph-music-notes"></i>
                <div>
                    <p>Jazz</p>
                    <span>Genres</span>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    const searchModal = document.getElementById("search-modal");
    const moreOptionsBtn = document.getElementById("more-options");

    // Åbn modal
    moreOptionsBtn.addEventListener("click", () => {
        searchModal.classList.remove("hidden");
    });

    // Luk modal ved klik udenfor indholdet
    searchModal.addEventListener("click", (e) => {
        if (e.target === searchModal) {
            searchModal.classList.add("hidden");
        }
    });
</script>
<script>
const listContainer = document.querySelector(".search-list");
const filterButtons = document.querySelectorAll(".filter-btn");
const searchInput = document.querySelector(".search-input");


// Her gemmer vi API-data
const data = {
    all: [],
    genres: [],
    mood: [],
    tempo: []
};

// 1️⃣ Hent alle API-data (kun tempo, mood, genres)
async function loadAllCategories() {
    const genresRes = await fetch("/api/genre");
    const genres = await genresRes.json();

    const moodRes = await fetch("/api/mood");
    const mood = await moodRes.json();

    const tempoRes = await fetch("/api/tempo");
    const tempo = await tempoRes.json();

    // Gem i strukturen
    data.genres = genres.map(x => ({ label: x.genre_name, type: "Genres" }));
    data.mood = mood.map(x => ({ label: x.mood_name, type: "Mood" }));
    data.tempo = tempo.map(x => ({ label: x.tempo_name, type: "Tempo" }));

    // All = alt fra alle kategorier
    data.all = [
        ...data.genres,
        ...data.mood,
        ...data.tempo
    ];

    renderList("all");
};

// 2️⃣ Render funktion — super simpel
function renderList(type) {
    listContainer.innerHTML = "";

    const searchValue = searchInput.value.toLowerCase();

    const items = data[type].filter(item =>
        item.label.toLowerCase().includes(searchValue)
    );

    items.forEach(item => {
        const el = document.createElement("div");
        el.className = "search-item";

        el.innerHTML = `
            <i class="ph-bold ph-magnifying-glass"></i>
            <div>
                <p>${item.label}</p>
            </div>
        `;

        el.onclick = () => {
            userSuggestsAttribute(item.type, item.label);
        };

        listContainer.appendChild(el);
    });
}


// 3️⃣ Filter-knap klik
filterButtons.forEach(btn => {
    btn.addEventListener("click", () => {

        filterButtons.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");

        const type = btn.dataset.type; // all, tempo, mood, genres
        renderList(type);
    });
});

// 4️⃣ Hent data når modal åbnes
document.getElementById("more-options").addEventListener("click", async () => {
    document.getElementById("search-modal").classList.remove("hidden");

    if (data.all.length === 0) {
        await loadAllCategories();
    }
});

searchInput.addEventListener("input", () => {
    const activeBtn = document.querySelector(".filter-btn.active");
    const type = activeBtn.dataset.type;
    renderList(type);
});

</script>


</body>
</html>